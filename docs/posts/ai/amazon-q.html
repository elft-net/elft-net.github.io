<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Peter Mostert">
<meta name="dcterms.date" content="2024-09-25">

<title>The Q-Factor – The Devops Society</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">The Devops Society</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../journal.html"> 
<span class="menu-text">Journal</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv.html"> 
<span class="menu-text">CV</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/elft-net"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/ethermol"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">The Q-Factor</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">amazon</div>
                <div class="quarto-category">aws</div>
                <div class="quarto-category">ai</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Peter Mostert </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 25, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>While our development pallet grows more generative and creative the providers got stuck into legacy branding patterns. The twitter guy is into X, microSoft brands all the things Copilot and Amazon is into Q.</p>
<p>Off all AI-providers Amazon Q provided the highest barrier of entry by far and still lacks support for the tools I generally use. But putting my bias aside I should be able to get something going so let’s see whats the Amazon-Q interface has to offer.</p>
<p>Don’t let the quantity of this post scare you away. Most of the content got generated by Q, has been added while it has relevancy but can be easily skimmed over!</p>
<p><strong>Amazon Q for command line</strong></p>
<p>The Amazon docs portal provides a <a href="https://docs.aws.amazon.com/amazonq/latest/qdeveloper-ug/command-line-getting-started-installing.html">document</a> describing how to get things going if using macOS.</p>
<p>Besides a mac this requires a subscription for Builder ID which seems to be free. After install a <code>q</code> command is added to the command pallet. At first sight the most appealing options are the CLI-completions and the CLI-chatbot. Lets play a bit with the latter.</p>
<p><strong>The Q-bot</strong></p>
<p>Lets first figure out if Q “knows” about Terraform which is a Third Party Tool (their native IaC tool is called CloudFormation) and Talos (available on AWS as a community AMI).</p>
<p>[mos@chap ~]$ q chat</p>
<p>Hi, I’m Amazon Q. I can answer questions about your shell and CLI tools! You can include additional context by adding the following to your prompt:</p>
<p><span class="citation" data-cites="history">@history</span> to pass your shell history <span class="citation" data-cites="git">@git</span> to pass information about your current git repository <span class="citation" data-cites="env">@env</span> to pass your shell environment</p>
<blockquote class="blockquote">
<p>can you give me some advice on terraform code in AWS</p>
</blockquote>
<p>Certainly! I’d be happy to provide some advice on using Terraform with AWS. Here are some best practices and tips to help you write effective and maintainable Terraform code for AWS: [1]</p>
<ol type="1">
<li><p>Use modules: Organize your code into reusable modules to improve maintainability and promote code reuse across different projects or environments.</p></li>
<li><p>Follow a consistent naming convention: Use a consistent naming scheme for your resources, variables, and outputs to improve readability and maintainability.</p></li>
<li><p>Use remote state storage: Store your Terraform state files in a remote backend like S3 with DynamoDB for state locking. This enables collaboration and helps prevent conflicts. [2]</p></li>
<li><p>Implement proper state management: Use workspaces or separate state files for different environments (dev, staging, prod) to keep your infrastructure isolated.</p></li>
<li><p>Use variables and locals: Leverage variables for values that might change and locals for computed values or to improve readability.</p></li>
<li><p>Implement proper version control: Use version control systems like Git to manage your Terraform code and track changes over time. [3]</p></li>
<li><p>Use data sources: Utilize data sources to fetch existing AWS resources instead of hardcoding values.</p></li>
<li><p>Implement proper tagging: Use tags for your AWS resources to improve organization, cost allocation, and resource management.</p></li>
<li><p>Use terraform-docs: Generate documentation automatically for your Terraform modules using tools like terraform-docs.</p></li>
<li><p>Implement proper error handling: Use the count parameter or for_each to handle conditional resource creation and avoid errors.</p></li>
<li><p>Use the AWS provider alias: When working with multiple AWS accounts or regions, use provider aliases to manage resources across different environments.</p></li>
<li><p>Implement proper security practices: Use IAM roles and policies to manage access, and avoid hardcoding sensitive information in your Terraform code.</p></li>
</ol>
<p>Here’s a simple example that demonstrates some of these practices:</p>
<pre class="hcl"><code># Define the AWS provider
provider "aws" {
  region = var.aws_region
}

# Use a module for creating an EC2 instance
module "ec2_instance" {
  source  = "terraform-aws-modules/ec2-instance/aws"
  version = "~&gt; 3.0"

  name = "my-ec2-instance"

  ami                    = data.aws_ami.amazon_linux_2.id
  instance_type          = var.instance_type
  key_name               = var.key_name
  monitoring             = true
  vpc_security_group_ids = [aws_security_group.allow_ssh.id]
  subnet_id              = var.subnet_id

  tags = {
    Terraform   = "true"
    Environment = var.environment
  }
}

# Use a data source to fetch the latest Amazon Linux 2 AMI
data "aws_ami" "amazon_linux_2" {
  most_recent = true
  owners      = ["amazon"]

  filter {
    name   = "name"
    values = ["amzn2-ami-hvm-*-x86_64-gp2"]
  }
}

# Create a security group
resource "aws_security_group" "allow_ssh" {
  name        = "allow_ssh"
  description = "Allow SSH inbound traffic"
  vpc_id      = var.vpc_id

  ingress {
    description = "SSH from VPC"
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = [var.vpc_cidr]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = {
    Name = "allow_ssh"
  }
}

# Define variables
variable "aws_region" {
  description = "AWS region"
  type        = string
  default     = "us-west-2"
}

variable "instance_type" {
  description = "EC2 instance type"
  type        = string
  default     = "t2.micro"
}

variable "key_name" {
  description = "Key pair name"
  type        = string
}

variable "subnet_id" {
  description = "Subnet ID"
  type        = string
}

variable "vpc_id" {
  description = "VPC ID"
  type        = string
}

variable "vpc_cidr" {
  description = "VPC CIDR block"
  type        = string
}

variable "environment" {
  description = "Environment name"
  type        = string
  default     = "dev"
}

# Output the instance ID
output "instance_id" {
  description = "ID of the EC2 instance"
  value       = module.ec2_instance.id
}</code></pre>
<p>This example demonstrates the use of modules, data sources, variables, and proper resource organization. Remember to adapt this code to your specific needs and always follow AWS best practices for security and resource management.</p>
<p>1 https://aws.amazon.com/about-aws/whats-new/2023/11/amazon-codecatalyst-supports-terraform/ 2 https://repost.aws/articles/AR1Iq4DrJtThK4K2svXyuF3w/using-codecatalyst-to-deploy-terraform-infrastructure-as-code 3 https://docs.aws.amazon.com/prescriptive-guidance/latest/getting-started-terraform/introduction.html</p>
<p>Ooempf, that does not disappoint. Now let’s try somethinig more specific.</p>
<p><strong>IaC for an Instance running Talos</strong></p>
<blockquote class="blockquote">
<p>I would like to have the terraform code that provides me with a talos image running the control plane as well as the worker plane for a medium developer setup. The terraform code should provide an EC2 resource with sufficient capacity to run a medium developer instance. Initially it can run in the default vpc. Can you provide the terraform code needed to provision this ?</p>
</blockquote>
<p>Certainly! I can provide you with Terraform code to set up an EC2 instance running a Talos image for both the control plane and worker plane in a medium developer setup. We’ll use the default VPC for simplicity. Here’s the Terraform code to achieve this:</p>
<pre class="hcl"><code>provider "aws" {
  region = "eu-central-1"  # Change this to your preferred region
}

data "aws_vpc" "default" {
  default = true
}

data "aws_subnets" "default" {
  filter {
    name   = "vpc-id"
    values = [data.aws_vpc.default.id]
  }
}

resource "aws_security_group" "talos_sg" {
  name        = "talos-security-group"
  description = "Security group for Talos Kubernetes cluster"
  vpc_id      = data.aws_vpc.default.id

  # Allow all outbound traffic
  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  # Allow inbound SSH access
  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  # Allow Kubernetes API server
  ingress {
    from_port   = 6443
    to_port     = 6443
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  # Allow Talos API
  ingress {
    from_port   = 50000
    to_port     = 50001
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }
}

data "aws_ami" "talos" {
  most_recent = true
  owners      = ["540036508848"] # Talos Systems' AWS account ID

  filter {
    name   = "name"
    values = ["talos-amd64-*"]
  }

  filter {
    name   = "virtualization-type"
    values = ["hvm"]
  }
}

resource "aws_instance" "talos_node" {
  ami           = data.aws_ami.talos.id
  instance_type = "t3.medium"  # Adjust as needed for your "medium developer setup"

  vpc_security_group_ids = [aws_security_group.talos_sg.id]
  subnet_id              = data.aws_subnets.default.ids[0]

  root_block_device {
    volume_type = "gp3"
    volume_size = 50  # Adjust as needed
  }

  tags = {
    Name = "talos-node"
  }

  user_data = &lt;&lt;-EOF
              {
                "version": "v1alpha1",
                "persist": true,
                "machine": {
                  "type": "controlplane",
                  "token": "${random_password.talos_token.result}",
                  "ca": {
                    "crt": "${base64encode(tls_self_signed_cert.talos_ca.cert_pem)}",
                    "key": "${base64encode(tls_private_key.talos_ca.private_key_pem)}"
                  }
                },
                "cluster": {
                  "id": "${random_uuid.cluster_id.result}",
                  "secret": "${random_password.cluster_secret.result}",
                  "controlPlane": {
                    "endpoint": "https://${aws_instance.talos_node.public_ip}:6443"
                  }
                }
              }
              EOF
}

resource "random_password" "talos_token" {
  length  = 32
  special = false
}

resource "random_uuid" "cluster_id" {}

resource "random_password" "cluster_secret" {
  length  = 32
  special = false
}

resource "tls_private_key" "talos_ca" {
  algorithm = "RSA"
  rsa_bits  = 4096
}

resource "tls_self_signed_cert" "talos_ca" {
  private_key_pem = tls_private_key.talos_ca.private_key_pem

  subject {
    common_name = "talos"
  }

  validity_period_hours = 8760  # 1 year

  allowed_uses = [
    "key_encipherment",
    "digital_signature",
    "server_auth",
    "client_auth",
  ]

  is_ca_certificate = true
}

output "talos_node_public_ip" {
  value = aws_instance.talos_node.public_ip
}

output "talos_node_private_ip" {
  value = aws_instance.talos_node.private_ip
}
</code></pre>
<p>This Terraform code does the following:</p>
<ol type="1">
<li>Sets up the AWS provider (you’ll need to configure your AWS credentials).</li>
<li>Uses the default VPC and subnet.</li>
<li>Creates a security group allowing necessary inbound traffic for Talos and Kubernetes.</li>
<li>Finds the latest Talos AMI.</li>
<li>Creates an EC2 instance using the Talos AMI with a t3.medium instance type (adjust as needed).</li>
<li>Generates necessary tokens, IDs, and certificates for Talos configuration.</li>
<li>Provides the Talos configuration as user data to the EC2 instance.</li>
</ol>
<p>To use this code:</p>
<ol type="1">
<li>Save it to a file with a .tf extension (e.g., talos_setup.tf).</li>
<li>Run terraform init to initialize the Terraform working directory. [1]</li>
<li>Run terraform plan to see the execution plan.</li>
<li>Run terraform apply to create the resources.</li>
</ol>
<p>After applying, you’ll get the public and private IP addresses of the Talos node as outputs.</p>
<p>Note that this setup creates a single node acting as both control plane and worker. For a production environment, you’d want to separate these and create multiple nodes. Also, remember to secure your cluster properly, as this example opens some ports to 0.0.0.0/0 for simplicity.</p>
<p>To fully set up and interact with your Talos cluster, you’ll need to install the Talos CLI (talosctl) on your local machine and perform additional configuration steps. Refer to the Talos documentation for post- installation steps and how to interact with your new cluster.</p>
<p>1 https://repost.aws/articles/ARcZH31DCIS-K3Ivns0ey-dA/automating-ec2-instance-naming-with-terraform-and-user-data-a-solution-for-dynamic-environments</p>
<blockquote class="blockquote">

</blockquote>
<p><strong>Good Practices</strong></p>
<p>None of the good practices of the generic example got implemented in the specific code. Moreover port 22 is opened for the public while Talos does not require this afaik.</p>
<p>Had to do some fiddling for to get the correct ami selected and removed a self reference to the end-point but then the plan seemd to come together.</p>
<pre><code>Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

random_uuid.cluster_id: Creating...
tls_private_key.talos_ca: Creating...
random_uuid.cluster_id: Creation complete after 0s [id=6352c2f2-f216-1659-eb51-d019287cb7bc]
random_password.talos_token: Creating...
random_password.cluster_secret: Creating...
random_password.talos_token: Creation complete after 0s [id=none]
random_password.cluster_secret: Creation complete after 0s [id=none]
aws_security_group.talos_sg: Creating...
tls_private_key.talos_ca: Creation complete after 2s [id=e6c78d34a473c3e3498202797146adc7e644d339]
tls_self_signed_cert.talos_ca: Creating...
tls_self_signed_cert.talos_ca: Creation complete after 0s [id=160873380053405108687366549035503198069]
aws_security_group.talos_sg: Creation complete after 2s [id=sg-041c4f1a231aaa943]
aws_instance.talos_node: Creating...
aws_instance.talos_node: Still creating... [10s elapsed]
aws_instance.talos_node: Creation complete after 13s [id=i-00c4cb23e04838b0f]

Apply complete! Resources: 7 added, 0 changed, 0 destroyed.

Outputs:

talos_node_private_ip = "172.31.7.6"
talos_node_public_ip = "3.69.46.111"
[mos@chap ~/…/play/devops-directive-terraform-course/10-aws-talos]$</code></pre>
<p>In theory this should enable us to setup the Talos cluster but trying to do so returns:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Unable to connect</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>An error occurred during a connection to ec2-3-69-46-111.eu-central-1.compute.amazonaws.com:6443.</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    The site could be temporarily unavailable or too busy. Try again in a few moments.</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    If you are unable to load any pages, check your computer’s network connection.</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    If your computer or network is protected by a firewall or proxy, make sure that Firefox is permitted to access the web.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Not a good sign . . . trying to bootstrap the Talos node anyway caused some further havoc:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[mos@chap</span> ~/…/play/devops-directive-terraform-course/10-aws-talos]$ talosctl gen config talos-cluster https://3.69.46.111:6443</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">generating</span> PKI and tokens</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Created</span> /Users/mos/Repo/play/devops-directive-terraform-course/10-aws-talos/controlplane.yaml</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Created</span> /Users/mos/Repo/play/devops-directive-terraform-course/10-aws-talos/worker.yaml</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Created</span> /Users/mos/Repo/play/devops-directive-terraform-course/10-aws-talos/talosconfig</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[mos@chap</span> ~/…/play/devops-directive-terraform-course/10-aws-talos]$ talosctl apply-config <span class="at">--insecure</span> <span class="at">-n</span> 3.69.46.111 <span class="at">--file</span> controlplane.yaml                                                                                      </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="ex">error</span> applying new configuration: rpc error: code = Unavailable desc = connection error: desc = <span class="st">"transport: Error while dialing: dial tcp 3.69.46.111:50000: connect: connection refused"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Next Steps</strong></p>
<p>Referring to the <a href="https://www.talos.dev/v1.8/talos-guides/install/cloud-platforms/aws/">Talos Documentation</a> for how this should be done properly.</p>
<p>Bluntly following Q got something running up in the AWS Clouds. While the instance seemed to be properly running the talosctl service could not connect for some reason. This project was started at a pinch, not prepared for whatsoever so I might have picked an outdated image or try to use a workflow that is not applicable for this AMI . . . .</p>
<p>The Q-generated Terraform template is still a far stretch from what is described in the Talos docs. On the other hand that’s what I asked for, a developer instance running Talos so that’s what I got.</p>
<p>It would have been nice if it would have worked though. Might just save that for another rainy day.</p>
<p>What is left for now is <code>tf destroy</code> to take things back down again.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>